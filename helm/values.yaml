# Default values for kure
# This is a YAML-formatted file.

global:
  imageRegistry: ""
  imagePullSecrets: []

# Pod monitoring agent configuration
agent:
  # Grace period (seconds) before reporting Pending pods as failed.
  # Pods in Pending phase with no definitive container failure are given
  # this much time to start before being flagged. Default: 120 (2 minutes).
  pendingGracePeriod: 120

  # Cluster metrics collection (CPU, memory, pod counts, etc.)
  clusterMetrics:
    enabled: true  # Set to false to disable cluster metrics collection

  image:
    repository: ghcr.io/nan0c0de/kure-monitor/agent
    tag: "1.6.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  nodeSelector: {}
  tolerations: []
  affinity: {}

  # RBAC settings
  rbac:
    create: true

  serviceAccount:
    create: true
    name: kure-agent
    automountServiceAccountToken: true  # Required for Kubernetes API access

# Security scanner agent configuration
securityScanner:
  image:
    repository: ghcr.io/nan0c0de/kure-monitor/security-scanner
    tag: "1.6.0"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  nodeSelector: {}
  tolerations: []
  affinity: {}

  # RBAC settings
  rbac:
    create: true

  serviceAccount:
    create: true
    name: kure-security-scanner
    automountServiceAccountToken: true  # Required for Kubernetes API access

# Backend configuration
backend:
  replicaCount: 1
  
  image:
    repository: ghcr.io/nan0c0de/kure-monitor/backend
    tag: "1.6.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  # Database configuration - PostgreSQL only
  database:
    type: postgresql
  
  nodeSelector: {}
  tolerations: []
  affinity: {}

  # RBAC settings for pod logs access
  rbac:
    create: true

  serviceAccount:
    create: true
    name: kure-backend
    automountServiceAccountToken: true  # Required for pod logs API access

# Frontend configuration
frontend:
  replicaCount: 1

  image:
    repository: ghcr.io/nan0c0de/kure-monitor/frontend
    tag: "1.6.0"
    pullPolicy: IfNotPresent

  service:
    type: NodePort
    port: 8080
    targetPort: 8080
    nodePort: 30080

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Environment variables for React app
  env:
    REACT_APP_API_URL: ""  # Will be set automatically to backend service

  nodeSelector: {}
  tolerations: []
  affinity: {}

  # Service account settings - frontend doesn't need API access
  serviceAccount:
    create: true
    name: kure-frontend
    automountServiceAccountToken: false

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: kure.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: backend
  tls: []
    # - secretName: kure-tls
    #   hosts:
    #     - kure.local

# Security context - Container level
securityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# PostgreSQL configuration
postgresql:
  external: false  # Set to true to use external PostgreSQL

  # PostgreSQL connection details (for external or internal)
  host: ""  # Only required if external: true
  port: 5432
  database: kure
  username: kure
  password: "kure-password-change-me"  # Change this in production!

  # Internal PostgreSQL deployment settings (ignored if external: true)
  image:
    repository: postgres
    tag: "17.6-alpine3.21"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 250m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
    accessMode: ReadWriteOnce

  # Service account settings - postgresql doesn't need API access
  serviceAccount:
    create: true
    name: kure-postgresql
    automountServiceAccountToken: false

# Kyverno policy management configuration
kyverno:
  enabled: true                  # Enable Kyverno policy management in admin panel
  violationPollingInterval: 60   # Seconds between violation polling (default: 60)

# Prometheus metrics configuration
prometheus:
  enabled: false          # Enable Prometheus scraping network policy
  namespace: monitoring   # Namespace where Prometheus is deployed
  serviceMonitor:
    enabled: false        # Create ServiceMonitor resource (requires Prometheus Operator)

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001
